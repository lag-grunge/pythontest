
from bs4 import BeautifulSoup
from os import path
from pathlib import Path

path = path.realpath(__file__)
dirname = Path(path).parent.parent
q1 = dirname / "evilcorp.html"
q2 = dirname / "exploit_script"
q3 = dirname / "evilcorp_hacked.html"

# First, it needs to read a file "evilcorp.html"
with q1.open("r") as fp:
    data = BeautifulSoup(fp.read(), "html.parser")

# Second, it should modify page title (in <title> tags) to be "Evil Corp - Stealing your money every day"
data.title.string = "Evil Corp - Stealing your money every day"

# Third, it should parse out the name of the user
# from the page (including the pronoun)
# and inject new tag <h1> into a body of a page,
# saying <h1>Mr. Robot, you are hacked!</h1>,
# where 'Mr. Robot' is a parsed pronoun and name.

names = data.findAll(class_="name")
filteredNames =[]
for i in names:
    filteredNames.append(i.text)
for i in filteredNames:
    newtag = data.new_tag('h1')
    newtag.string = "{0} you've been hacked".format(i)
    data.body.append(newtag)

# Fourth, it needs to inject a Trenton's script into a body of a page as well.
# If everything is okay, when the 'Send' button is pressed, you should see
# the word "hacked" appearing in an alert window.

newscript = data.new_tag('script')
with q2.open("r") as fs:
    newscript.string = str(fs.read())
    data.body.append(newscript)

# Finally, the link at the bottom of a page should now lead
# to "https://mrrobot.fandom.com/wiki/Fsociety"
# with an actual name of the company on a page replaced with "Fsociety".

link = data.find(href="https://mrrobot.fandom.com/wiki/E_Corp")
link.attrs['href'] = "https://mrrobot.fandom.com/wiki/Fsociety"
link.string = "Fsociety"
with q3.open("w") as wf:
    wf.write(str(data))
